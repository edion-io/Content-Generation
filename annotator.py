from openai import OpenAI
import re
from utils import batch
import json

prompt = "We want to improve these elementary school exercises such that they can be used as training data. The top line is the input and the rest is the expected output (gold truth). Start by removing the second line of text then follow this protocol:\n\n1. Read the question and examine whether this question is usable without any context.\nIf a student could be shown the question and complete it without anything else (just by reading the text you are reading and drawing the diagram themselves solely from the descriptions) then continue with steps a - e, otherwise go to 2.\na.  Try to replace the T on the first line with one or more general exercise types describing the type of exercise (e.g., Arithmetic Exercise, Fill in the Blank, Matching Exercise, Estimation Exercise, Word Problem, and anything else you can come up with). Encase them all under one set of parentheses and ensure each word's first letter is capitalized. If you can't think of anything, leave it as T (without parentheses).\nb. Try to replace the M on the first line with one or more specifications on the exercise type, the question, or the subject. (e.g., Multi-part if the question has more than 1 part, With Answer if the answer is present, Exercise on [topic]  if you want to specify what the exercise is about, Exercise using an illustration, With Illustration, and anything else you come up with). Encase them all under one set of parentheses. If you can't think of anything, leave it as M (without parentheses).\nc. Ensure that the top line keeps its format and order: S T D G M, where S is the subject, that has already been written for you, T may be replaced by you in the previous step a , D stays as D, G is a number that has already been written for you and  M may be replaced by you in the previous step b.\nd. Ensure that the question uses Latex where relevant. This includes changing lists to numeric, or alphabetic enumerate or itemize, where appropriate, creating a latex table if necessary, or ensuring that fractions, equations, and any math are in math notation. Assume we are writing in text and that equations are either introduced as a begin{equation*} or using in-line notation like \\(  [math stuff] \\). If the With Answer modifier is being used, then add a subsection{Answers} with the answer. Otherwise, do not.\ne. If the question content itself starts with a number (e.g., 9. [TEXT], 7. [TEXT]), remove that.\nf. Ensure that diagrams can be drawn entirely from reading their description (see 2a). For example, if the diagram is supposed to show a shape with dimensions, the description needs those dimensions or if it's supposed to show items for counting, we need to know how many.\n\n2. If the question is not usable without any context, then see if one of these steps can solve the issue, otherwise go to 3:\na. If a diagram ([STRDGM] ... [STPDGM]) does not make sense see if you can change the description to be more detailed, such that someone could draw this diagram following the description. For example, the diagram should specify quantities or dimensions. You might have to come up with your own values, or just create an alternative diagram that works better with a new question (see b). If the diagram is not necessary or simply a superficial add-on to the question, consider adding \"With Illustration\" as a modifier.\nb. If the question doesn't make sense (due to a diagram or any other reason), try  to change the question itself to make more sense, and make sure it is appropriate as a standalone question. Keep in mind these are elementary school questions, but also make the difficulty appropriate.\nc. If the diagram is actually a table, or the question refers to a table but it isn't there, then see if you can create a table that  works with the question. Remember that you may have to change the question accordingly.\n\n3. If neither step 1 or 2 works, then simply output the question with \"DELETE\" on top of it. \n\nTwo examples:\ninput:\n(Mathematics) T D 6 M\n\n[Word problem]\n10. 50% of children in a sports club go swimming.\n[STRDGM] A visual representation of children, some swimming and some not, indicating the percentage. [STPDGM]\n\nexpected output:\n(Mathematics) (Word Problem, Arithmetic Exercise) D 6 (With Illustration, Multi-part)\n\n50\\% of children in a sports club go swimming. \n\\begin{enumerate}[label=\\alph*.]\n\\item How many children do not go swimming based on the diagram?\n\\item How many children are there in total?\n\\end{enumerate}\n\n[STRDGM] A visual representation of children, with 10 swimming in water and 10 standing in a square. [STPDGM]\n------------\ninput: \n(Mathematics) T D 6 M\n\n[Word problem]\n9. 75% of a number is 48. What is the number?\n[STRDGM] A mathematical equation indicating a percentage of an unknown number. [STPDGM]\n\nexpected output:\n(Mathematics) (Word Problem) D 6 (With Answer)\n\n75\\% of a number is 48. What is the number?\n\n\\subsection{Answers}\nThe number is 64."

existing = []
if __name__ == "__main__" :
    client = OpenAI(api_key="sk-proj-ltmkMm6qZ8oQCsusN5IOT3BlbkFJmsPopivPYwLtY7jlx5Pl")

    # Extract all the questions from the file
    with open("new.txt", "r") as f:
        content = "".join(f.readlines())
    
    questions = re.split(r'(?m)(?=^\(Mathematics\))', content)
    questions = [q for q in questions if '[STRDGM]' in q] 
    
    
    
